<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="manifest" href="manifest.json">
  <style>
    :root {
      --blockquote-color: lightgray;
    }
    :link {
      color: var(--link-color);
    }
    :visited {
      color: var(--visited-link-color)
    }
    :link:active {
      color: red;
    }
    #readme {
      border: 4px double;
      padding: 5px;
      height: 15em;
      overflow-y: scroll;
      resize: vertical;
    }
    #readme blockquote{
      border-left: 5px var(--blockquote-color) solid;
      padding-left: 1rem;
    }
  </style>
  <script src="showdown.js"></script>
  <script>
    let converter = new showdown.Converter();
    fetch("README.md").then(response => response.text().then(string => readme.innerHTML = converter.makeHtml(string)));

    const THEME_COLORS = Object.freeze({
      light: {
        "color": "black",
        "background-color": "white",
        "--blockquote-color": "lightgray",
        "--link-color": "blue",
        "--visited-link-color": "purple"
      },
      dark: {
        "color": "white",
        "background-color": "black",
        "--blockquote-color": "darkgray",
        "--link-color": "cyan",
        "--visited-link-color": "magenta"
      }
    });

    function setStyleMode(styles) {
      for (const key in styles) {
        const value = styles[key];
        document.documentElement.style.setProperty(key, value);
      }
    }

    onload = function () {
      let themeselector = document.getElementById("themeselector");
      themeselector.onchange = function () {setStyleMode(THEME_COLORS[this.value])};
      if (window.matchMedia("(prefers-color-scheme:light)").matches) themeselector.value = "dark";
      if (window.matchMedia("(prefers-color-scheme:dark)").matches) themeselector.value = "dark";
      themeselector.onchange();
    }
  </script>
  
  <link rel="icon" type="image/png" href="icon.png"/>
  <link rel="apple-touch-icon" href="icon.png" type="image/png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Puzzle stacker clone">
  <meta charset="UTF-8">
  <title>P5.js Tetrominoes</title>
</head>
<body>
  <div style="position: fixed; top: 5px; right: 5px; border: 2px solid;">
    <select name="Theme Selector" id="themeselector">
      <option value="light">Light mode</option>
      <option value="dark">Dark mode</option>
    </select>
  </div>
  <h1>P5.js Tetrominoes</h1>
  <button onclick="game.contentWindow.location.reload();">Reload game</button>
  <div><iframe src="p5js-tetrominoes/game.html" id="game" width="640" height="480" alt="An iframe containing the game"></iframe></div>
  <a href="http://github.com/wmpowell8/p5js-tetrominoes">View source - github.com/wmpowell8/p5js-tetrominoes</a>
  <h2>Readme</h2>
  Powered by <a href="https://github.com/showdownjs/showdown">showdown.js</a>
  <div id="readme" alt="Content automatically generated by showdown"></div>

  <script>
    var PWA_DEBUG = false;

    if ("serviceWorker" in navigator) {
      navigator.serviceWorker
        .register('./sw.js')
        .then(function() { if (PWA_DEBUG) console.log("%cService Worker Registered", "color: green;", arguments); })
        .catch(function () {
          if (PWA_DEBUG) console.log("%cAn error occurred while registering the service worker", "color: red;");
          if (PWA_DEBUG) console.log("%c", "color: red;", arguments);
        });
    } else {
      if (PWA_DEBUG) console.log("%cUnable to registrer service worker", "color: orange;");
    }
  </script>
</body>
</html>